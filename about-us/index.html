<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BZZFKMJ65Y"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-BZZFKMJ65Y');
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>About Rugatha</title>
  <link rel="icon" type="image/png" href="../assets/rugatha-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../assets/rugatha-icon-32.png">
  <link rel="stylesheet" href="../shared/styles/theme.css">
  <link rel="stylesheet" href="styles/about.css">
  <meta property="og:image" content="https://rugatha.github.io/web/assets/rugatha-banner.jpg">
  <meta name="twitter:image" content="https://rugatha.github.io/web/assets/rugatha-banner.jpg">
  <meta name="twitter:card" content="summary_large_image">

</head>
<body>
  <div class="page">
    <header class="banner" aria-label="Rugatha banner image">
      <a href="../index.html" class="banner-link" aria-label="Back to Rugatha home">
        <img src="../assets/rugatha-banner.jpg" alt="Rugatha banner" class="banner-logo" loading="lazy">
      </a>
    </header>

    <main class="page-shell about-shell">
      <section class="hero">
        <div class="hero-copy">
          <p class="eyebrow">About Rugatha</p>
          <h2>神祇與冒險碰撞，魔法與故事綻放</h2>
          <h2>Gods and Adventures Collides, Magic and Stories Blossoms</h2>
          <p class="lede">Rugatha D&D是台灣原創的「龍與地下城」世界觀、團務，與設定<br>從2021年中第一次跑團，至今已經數年了<br>一開始，我們只是一群私下跑團的朋友，但一路上認識了越來越多人，也組成擁有不同面向的團隊，一起擴展這個世界，寫下屬於我們獨有的故事</p>
          <div class="lede-divider" aria-hidden="true"></div>
          <p class="lede">Rugatha D&D is a original Dungeons and Dragons world, campaigns and settings from Taiwan<br>It's been some years since we started in mid 2021<br>We started as friends playing D&D in private, but we've met new people along the way, built a team with differet aspects, to expand this world, and write our own stories</p>
          <div class="pill-row">
            <span class="pill">TRPG</span>
            <span class="pill">D&D 5e</span>
            <span class="pill">Rugatha</span>
          </div>
        </div>
        <figure class="hero-graphic">
          <img class="hero-badge" src="../assets/rugatha-icon.png" alt="" aria-hidden="true">
          <img class="hero-photo" src="assets/rugatha-photo.png" alt="Rugatha table moment" loading="lazy">
        </figure>
      </section>

      <section class="checklist">
        <div class="check-item">
          <span class="check-icon" aria-hidden="true"></span>
          <p class="check-text"><b>與官方不同的世界觀</b></p>
        </div>
        <div class="check-item">
          <span class="check-icon" aria-hidden="true"></span>
          <p class="check-text"><b>獨一無二的劇本</b></p>
        </div>
        <div class="check-item">
          <span class="check-icon" aria-hidden="true"></span>
          <p class="check-text"><b>從玩家角色出發，量身定做的個人故事線</b></p>
        </div>
        <div class="check-item">
          <span class="check-icon" aria-hidden="true"></span>
          <p class="check-text"><b>你從未有過的D&D體驗</b></p>
        </div>
      </section>

      <section class="timeline">
        <div class="timeline-intro">
          <p class="section-label">Our journey</p>
          <h2>Rugatha 的里程碑</h2>
        </div>
        <div class="timeline-track" aria-label="Rugatha timeline">
          <article class="timeline-item con">
            <div class="timeline-date">
              <span class="timeline-year">2025/12/13<br>2025/12/14</span>
              <span class="timeline-meta">D3</span>
            </div>
            <div class="timeline-marker" aria-hidden="true">
              <span class="marker-dot"></span>
            </div>
            <div class="timeline-card">
              <span class="timeline-tag con">Con</span>
              <h3>2025 龍山地下城</h3>
              <p>Rugatha D&D首次參與擺攤，並主持兩天共8場的D&D跑團體驗</p>
              <p class="timeline-note">"Is it the answer you want? Or to survive and leave this room?" The Golden Dragon asked, in a gentle voice.<br>-- The Dragonslayers' Dining Table</p>
            </div>
          </article>

          <article class="timeline-item con">
            <div class="timeline-date">
              <span class="timeline-year">2025/5/11</span>
              <span class="timeline-meta">TRPG FES.</span>
            </div>
            <div class="timeline-marker" aria-hidden="true">
              <span class="marker-dot"></span>
            </div>
            <div class="timeline-card">
              <span class="timeline-tag con">Con</span>
              <h3>2025 桌上角色扮演嘉年華</h3>
              <p>Rugatha D&D名片初登場</p>
              <p class="timeline-note">Hi we are Rugatha D&D :)</p>
            </div>
          </article>

          <article class="timeline-item campaign">
            <div class="timeline-date">
              <span class="timeline-year">2024/3/16</span>
              <span class="timeline-meta">WILDS</span>
            </div>
            <div class="timeline-marker" aria-hidden="true">
              <span class="marker-dot"></span>
            </div>
            <div class="timeline-card">
              <span class="timeline-tag campaign">Campaign</span>
              <h3>Rugatha WILDS</h3>
              <p>新的一批冒險者們在貝瑟頓的酒館相遇，但他們並不知道，這是命運的牽引而非巧合</p>
              <p class="timeline-note">Pieces of papers, like puzzles, fit into each others.</p>
            </div>
          </article>

          <article class="timeline-item campaign">
            <div class="timeline-date">
              <span class="timeline-year">2022/8/6</span>
              <span class="timeline-meta">lite</span>
            </div>
            <div class="timeline-marker" aria-hidden="true">
              <span class="marker-dot"></span>
            </div>
            <div class="timeline-card">
              <span class="timeline-tag campaign">Campaign</span>
              <h3>Rugatha lite</h3>
              <p>新的冒險者加入殘存的夥伴，月神芬尼爾的勢力逐漸籠罩</p>
              <p class="timeline-note">"Sebano, Town of Villains." Yeah, sure, why not?</p>
            </div>
          </article>

          <article class="timeline-item campaign">
            <div class="timeline-date">
              <span class="timeline-year">2022/7/23</span>
              <span class="timeline-meta">Plus</span>
            </div>
            <div class="timeline-marker" aria-hidden="true">
              <span class="marker-dot"></span>
            </div>
            <div class="timeline-card">
              <span class="timeline-tag campaign">Campaign</span>
              <h3>Rugatha Plus</h3>
              <p>冒險者分道揚鑣，冒險團隊之一回到麥克嵩探尋拉索斯的陰謀</p>
              <p class="timeline-note">The gates of Macksohn was still there, but you know it's different from the first time you step into this city.</p>
            </div>
          </article>

          <article class="timeline-item campaign">
            <div class="timeline-date">
              <span class="timeline-year">2021/5/22</span>
              <span class="timeline-meta">Start</span>
            </div>
            <div class="timeline-marker" aria-hidden="true">
              <span class="marker-dot"></span>
            </div>
            <div class="timeline-card">
              <span class="timeline-tag campaign">Campaign</span>
              <h3>Rugatha</h3>
              <p>冒險者們第一次在Rugatha的世界登場</p>
              <p class="timeline-note">You all meet in a tavern......</p>
            </div>
          </article>
        </div>
      </section>

      <section class="social-links">
        <blockquote class="boba-embed">
          <style data-styled="true" data-styled-version="5.3.3">
            .eDynhg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;width:164px;height:40px;padding:8px 16px;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border-radius:12px;color:white;-webkit-text-decoration:none !important;text-decoration:none !important;}/*!sc*/
            .eDynhg:hover{-webkit-text-decoration:none !important;text-decoration:none !important;}/*!sc*/
            data-styled.g160[id="sc-1ykasxb-0"]{content:"eDynhg,"}/*!sc*/
          </style>
          <a style="background-color:#B0553F;color:#F8E0BE;border:none" href="https://rugathadnd.bobaboba.me" target="_blank" class="sc-1ykasxb-0 eDynhg boba-btn"><img height="100%" style="border-radius:50%;border:1px solid rgba(255, 255, 255, 0.16);background:rgba(255, 255, 255, 0.12);box-sizing:border-box;" src="assets/donate_icon.png" alt="donate icon"/><div style="flex:1;text-align:left">小額贊助<br>Donate us</div></a>
        </blockquote>
        <a class="social-btn fb" href="https://www.facebook.com/rugatha" target="_blank" rel="noopener">
          <span class="social-icon" aria-hidden="true">
            <img src="assets/fb-icon.png" alt="" aria-hidden="true">
          </span>
        </a>
        <a class="social-btn ig" href="https://www.instagram.com/rugathadnd" target="_blank" rel="noopener">
          <span class="social-icon" aria-hidden="true">
            <img src="assets/ig-icon.png" alt="" aria-hidden="true">
          </span>
        </a>
        <a class="social-btn threads" href="https://www.threads.com/@rugathadnd" target="_blank" rel="noopener">
          <span class="social-icon" aria-hidden="true">
            <img src="assets/threads-icon.png" alt="" aria-hidden="true">
          </span>
        </a>
        <a class="social-btn mail" href="mailto:rugathadnd@gmail.com?subject=Hello%20Rugatha" rel="noopener">
          <span class="social-icon" aria-hidden="true">
            <img src="assets/gmail-icon.webp" alt="" aria-hidden="true">
          </span>
        </a>
      </section>
    </main>
  </div>

  <script src="../shared/rugatha.config.js"></script>
  <script src="../shared/firebase.config.js"></script>
  <script type="module" src="../shared/auth.js"></script>
  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import {
      getDatabase,
      ref,
      get,
      runTransaction
    } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

    const firebaseConfig = window.RUGATHA_FIREBASE_CONFIG || null;
    const firebaseDisabled =
      window.RUGATHA_FEATURE_FLAGS && window.RUGATHA_FEATURE_FLAGS.firebaseEnabled === false;
    const SOCIAL_LINKS = [
      "https://www.facebook.com/rugatha",
      "https://www.instagram.com/rugathadnd",
      "https://www.threads.com/@rugathadnd"
    ];
    const ACHIEVEMENTS_CSV_PATH = "../member/achievements.csv";
    const ACHIEVEMENT_CODE = "ach-PT";

    let auth = null;
    let db = null;
    let currentUser = null;
    let achievementData = null;
    let achievementLoadPromise = null;

    const parseCsv = (text) => {
      const rows = [];
      let row = [];
      let cell = "";
      let inQuotes = false;
      for (let i = 0; i < text.length; i += 1) {
        const char = text[i];
        if (inQuotes) {
          if (char === "\"") {
            if (text[i + 1] === "\"") {
              cell += "\"";
              i += 1;
            } else {
              inQuotes = false;
            }
          } else {
            cell += char;
          }
        } else if (char === "\"") {
          inQuotes = true;
        } else if (char === ",") {
          row.push(cell);
          cell = "";
        } else if (char === "\n") {
          row.push(cell);
          rows.push(row);
          row = [];
          cell = "";
        } else if (char !== "\r") {
          cell += char;
        }
      }
      if (cell.length || row.length) {
        row.push(cell);
        rows.push(row);
      }
      return rows;
    };

    const loadAchievementData = async () => {
      if (achievementLoadPromise) return achievementLoadPromise;
      achievementLoadPromise = (async () => {
        try {
          const response = await fetch(ACHIEVEMENTS_CSV_PATH, { cache: "no-store" });
          if (!response.ok) {
            throw new Error(`Failed to load achievements CSV: ${response.status}`);
          }
          const text = await response.text();
          const rows = parseCsv(text);
          if (!rows.length) return null;
          const headers = rows[0].map((header) => String(header || "").trim());
          const target = rows.slice(1).find((row) => row[0] === ACHIEVEMENT_CODE);
          if (!target) return null;
          const record = {};
          headers.forEach((header, index) => {
            record[header] = target[index] ?? "";
          });
          achievementData = {
            achievement: ACHIEVEMENT_CODE,
            flavorZh: record.flavorZh || "",
            flavorEn: record.flavorEn || "",
            rewards: {
              BadgeSTR: Number(record.STR || 0),
              BadgeDEX: Number(record.DEX || 0),
              BadgeCON: Number(record.CON || 0),
              BadgeINT: Number(record.INT || 0),
              BadgeWIS: Number(record.WIS || 0),
              BadgeCHA: Number(record.CHA || 0)
            }
          };
          return achievementData;
        } catch (error) {
          console.error("Failed to load achievement data", error);
          return null;
        }
      })();
      return achievementLoadPromise;
    };

    const showAchievementToast = (flavorZh, flavorEn) => {
      if (!flavorZh && !flavorEn) return;
      if (!document.body) return;
      const styleId = "rugatha-achievement-toast-style";
      if (!document.getElementById(styleId)) {
        const style = document.createElement("style");
        style.id = styleId;
        style.textContent = `
          .achievement-toast-wrap {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 9999;
            display: grid;
            gap: 10px;
            pointer-events: none;
          }
          .achievement-toast {
            min-width: 220px;
            max-width: 320px;
            background: rgba(248, 250, 252, 0.95);
            color: #1b2a26;
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 14px;
            padding: 12px 14px;
            box-shadow: 0 14px 30px rgba(0, 0, 0, 0.35);
            display: grid;
            gap: 6px;
            font-size: 0.85rem;
            line-height: 1.4;
            animation: toast-in 200ms ease-out;
          }
          .achievement-toast .toast-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            color: rgba(27, 42, 38, 0.7);
          }
          @keyframes toast-in {
            from { transform: translateY(6px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
          }
        `;
        document.head.appendChild(style);
      }
      let wrap = document.querySelector(".achievement-toast-wrap");
      if (!wrap) {
        wrap = document.createElement("div");
        wrap.className = "achievement-toast-wrap";
        document.body.appendChild(wrap);
      }
      const toast = document.createElement("div");
      toast.className = "achievement-toast";
      const title = document.createElement("div");
      title.className = "toast-title";
      title.textContent = "89e3939662105c31Ff1a";
      toast.appendChild(title);
      if (flavorZh) {
        const zh = document.createElement("div");
        zh.textContent = flavorZh;
        toast.appendChild(zh);
      }
      if (flavorEn) {
        const en = document.createElement("div");
        en.textContent = flavorEn;
        toast.appendChild(en);
      }
      wrap.appendChild(toast);
      window.setTimeout(() => {
        toast.remove();
        if (wrap && !wrap.children.length) {
          wrap.remove();
        }
      }, 4500);
    };

    const resolveMemberId = async (user) => {
      if (!user || !db) return null;
      const defaultId = user.uid;
      try {
        const snapshot = await get(ref(db, `members/${defaultId}`));
        if (snapshot.exists()) {
          const data = snapshot.val() || {};
          return data.memberId || defaultId;
        }
      } catch (error) {
        console.warn("Failed to resolve member id", error);
      }
      return defaultId;
    };

    const awardAchievement = async () => {
      if (!currentUser || !db) return;
      const achievement = await loadAchievementData();
      if (!achievement) return;
      const memberId = await resolveMemberId(currentUser);
      if (!memberId) return;
      const memberRef = ref(db, `members/${memberId}`);
      let awarded = false;
      try {
        const result = await runTransaction(memberRef, (current) => {
          const existing = current || {};
          const existingAchievements = existing.achievements || {};
          if (existingAchievements[achievement.achievement]) {
            return existing;
          }
          awarded = true;
          const nextAchievements = { ...existingAchievements, [achievement.achievement]: true };
          const next = { ...existing, achievements: nextAchievements };
          Object.entries(achievement.rewards || {}).forEach(([key, value]) => {
            const baseValue = Number(existing[key]);
            const safeBase = Number.isFinite(baseValue) ? baseValue : 10;
            const rewardValue = Number.isFinite(value) ? value : 0;
            next[key] = safeBase + rewardValue;
          });
          return next;
        });
        if (result.committed && awarded) {
          showAchievementToast(achievement.flavorZh, achievement.flavorEn);
        }
      } catch (error) {
        console.error("Failed to award achievement", error);
      }
    };

    const setupSocialTracking = () => {
      const links = Array.from(document.querySelectorAll("a[href]")).filter((link) =>
        SOCIAL_LINKS.includes(link.href)
      );
      if (!links.length) return;
      links.forEach((link) => {
        link.addEventListener("click", () => {
          awardAchievement();
        });
      });
    };

    if (!firebaseDisabled && firebaseConfig) {
      const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getDatabase(app);
      onAuthStateChanged(auth, (user) => {
        currentUser = user || null;
      });
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", setupSocialTracking);
    } else {
      setupSocialTracking();
    }
  </script>
</body>
</html>
